<div class="receptions-container">
  <p-card>
    <div class="header-section">
      <h2>Réceptions de Commandes</h2>
      <button
        pButton
        icon="pi pi-list"
        label="Toutes les Commandes"
        routerLink="/commandes-achat"
        class="p-button-secondary"
      ></button>
    </div>

    <div class="filters-section">
      <div class="filter-group">
        <label>Fournisseur</label>
        <p-dropdown
          [(ngModel)]="selectedFournisseur"
          [options]="fournisseurs"
          optionLabel="nom"
          optionValue="id"
          placeholder="Tous les fournisseurs"
          [showClear]="true"
          (onChange)="applyFilters()"
        ></p-dropdown>
      </div>

      <div class="filter-group">
        <label>Date début</label>
        <p-calendar
          [(ngModel)]="dateDebut"
          dateFormat="dd/mm/yy"
          [showIcon]="true"
          (onSelect)="applyFilters()"
        ></p-calendar>
      </div>

      <div class="filter-group">
        <label>Date fin</label>
        <p-calendar
          [(ngModel)]="dateFin"
          dateFormat="dd/mm/yy"
          [showIcon]="true"
          (onSelect)="applyFilters()"
        ></p-calendar>
      </div>

      <div class="filter-actions">
        <button
          pButton
          icon="pi pi-times"
          label="Effacer"
          class="p-button-secondary"
          (click)="clearFilters()"
        ></button>
      </div>
    </div>

    <p-table
      [value]="receptions"
      [loading]="loading"
      [paginator]="true"
      [rows]="pageSize"
      [totalRecords]="totalRecords"
      [lazy]="true"
      (onLazyLoad)="onPageChange($event)"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Affichage de {first} à {last} sur {totalRecords} réceptions"
      responsiveLayout="scroll"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Numéro</th>
          <th>Fournisseur</th>
          <th>Date Commande</th>
          <th>Date Réception</th>
          <th>Montant Total</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-item>
        <tr>
          <td>
            <strong>{{ item.numero }}</strong>
          </td>
          <td>{{ item.fournisseur?.nom || 'N/A' }}</td>
          <td>{{ item.date | date:'dd/MM/yyyy' }}</td>
          <td>{{ item.date_reception ? (item.date_reception | date:'dd/MM/yyyy') : '-' }}</td>
          <td>
            <strong>{{ formatCurrency(item.montant_total) }}</strong>
          </td>
          <td>
            <p-tag
              [value]="item.statut"
              [severity]="getStatutSeverity(item.statut)"
            ></p-tag>
          </td>
          <td>
            <button
              pButton
              icon="pi pi-eye"
              class="p-button-text p-button-info"
              (click)="voirDetails(item)"
              pTooltip="Voir détails"
            ></button>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center">Aucune réception trouvée</td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>
