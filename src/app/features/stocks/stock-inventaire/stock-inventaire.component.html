<!-- src/app/features/stocks/stock-inventaire/stock-inventaire.component.html -->
<div class="inventaire-container">
  <p-card>
    <div class="header-section">
      <h2>Inventaire des Stocks</h2>
      <div class="actions">
        <p-dropdown 
          [(ngModel)]="selectedEntrepot"
          [options]="entrepots"
          optionLabel="nom"
          optionValue="id"
          placeholder="Tous les entrepôts"
          [showClear]="true"
          (onChange)="genererInventaire()"
        ></p-dropdown>
        <button 
          pButton 
          icon="pi pi-refresh" 
          label="Actualiser"
          (click)="genererInventaire()"
          [loading]="loading"
        ></button>
        <button 
          pButton 
          icon="pi pi-file-pdf" 
          label="Exporter PDF"
          class="p-button-danger"
          (click)="exportPDF()"
        ></button>
        <button 
          pButton 
          icon="pi pi-file-excel" 
          label="Exporter Excel"
          class="p-button-success"
          (click)="exportExcel()"
        ></button>
      </div>
    </div>

    <div *ngIf="loading" class="loading-section">
      <p-progressBar mode="indeterminate"></p-progressBar>
    </div>

    <!-- Debug info -->
    <div *ngIf="!loading" class="debug-info" style="background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 4px;">
      <small>
        <strong>Debug:</strong>
        Inventaire: {{ inventaire ? 'Chargé' : 'null' }} |
        Total produits: {{ inventaire?.total_produits || 0 }} |
        Entrepôts: {{ inventaire?.par_entrepot?.length || 0 }} |
        Catégories: {{ inventaire?.par_categorie?.length || 0 }}
      </small>
    </div>

    <div *ngIf="!loading && inventaire" class="inventaire-content">
      <!-- Statistiques globales -->
      <div class="stats-grid">
        <p-card class="stat-card">
          <div class="stat-content">
            <div class="stat-label">Total Produits</div>
            <div class="stat-value">{{ inventaire.total_produits }}</div>
          </div>
        </p-card>

        <p-card class="stat-card">
          <div class="stat-content">
            <div class="stat-label">Quantité Totale</div>
            <div class="stat-value">{{ inventaire.quantite_totale }}</div>
          </div>
        </p-card>

        <p-card class="stat-card">
          <div class="stat-content">
            <div class="stat-label">Valeur Totale</div>
            <div class="stat-value">{{ formatCurrency(inventaire.valeur_totale) }}</div>
          </div>
        </p-card>
      </div>

      <!-- Par Entrepôt -->
      <div class="section">
        <h3>Répartition par Entrepôt</h3>
        <p-table [value]="inventaire.par_entrepot">
          <ng-template pTemplate="header">
            <tr>
              <th>Entrepôt</th>
              <th>Nombre de Produits</th>
              <th>Quantité Totale</th>
              <th>Valeur Totale</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-item>
            <tr>
              <td><strong>{{ item.entrepot }}</strong></td>
              <td>{{ item.nombre_produits }}</td>
              <td><p-badge [value]="item.quantite_totale" severity="info"></p-badge></td>
              <td><strong>{{ formatCurrency(item.valeur_totale) }}</strong></td>
            </tr>
          </ng-template>
        </p-table>
      </div>

      <!-- Par Catégorie -->
      <div class="section">
        <h3>Répartition par Catégorie</h3>
        <p-table [value]="inventaire.par_categorie">
          <ng-template pTemplate="header">
            <tr>
              <th>Catégorie</th>
              <th>Nombre de Produits</th>
              <th>Quantité Totale</th>
              <th>Valeur Totale</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-item>
            <tr>
              <td><strong>{{ item.categorie }}</strong></td>
              <td>{{ item.nombre_produits }}</td>
              <td><p-badge [value]="item.quantite_totale" severity="info"></p-badge></td>
              <td><strong>{{ formatCurrency(item.valeur_totale) }}</strong></td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>

    <!-- État vide -->
    <div *ngIf="!loading && !inventaire" class="empty-state" style="text-align: center; padding: 40px;">
      <p><i class="pi pi-inbox" style="font-size: 3rem; color: #ccc;"></i></p>
      <p>Aucune donnée d'inventaire disponible</p>
      <p style="color: #666; font-size: 0.9em;">
        Vérifiez que des stocks existent dans la base de données
      </p>
      <p style="color: #999; font-size: 0.85em;">
        Consultez la console (F12) pour plus de détails
      </p>
    </div>
  </p-card>
</div>

