<!-- src/app/features/utilisateurs/utilisateurs-list/utilisateurs-list.component.html -->
<div class="utilisateurs-container">
  <p-card>
    <div class="header-section">
      <h2>Gestion des Utilisateurs</h2>
      <button 
        pButton 
        icon="pi pi-plus" 
        label="Nouvel Utilisateur" 
        (click)="openNew()"
        class="p-button-success"
      ></button>
    </div>

    <div class="filters-section">
      <div class="filter-group">
        <label>Rôle</label>
        <p-dropdown 
          [(ngModel)]="selectedRole"
          [options]="roles"
          optionLabel="label"
          optionValue="value"
          placeholder="Tous les rôles"
          [showClear]="true"
          (onChange)="applyFilters()"
        ></p-dropdown>
      </div>

      <div class="filter-group">
        <label>Recherche</label>
        <input 
          type="text" 
          pInputText 
          [(ngModel)]="searchTerm"
          placeholder="Nom, prénom ou email..."
          (keyup.enter)="applyFilters()"
        >
      </div>

      <div class="filter-actions">
        <button 
          pButton 
          icon="pi pi-search" 
          label="Rechercher"
          (click)="applyFilters()"
        ></button>
        <button 
          pButton 
          icon="pi pi-times" 
          label="Effacer"
          class="p-button-secondary"
          (click)="clearFilters()"
        ></button>
      </div>
    </div>

    <p-table 
      [value]="utilisateurs" 
      [loading]="loading"
      [paginator]="true"
      [rows]="pageSize"
      [totalRecords]="totalRecords"
      [lazy]="true"
      (onLazyLoad)="onPageChange($event)"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Affichage de {first} à {last} sur {totalRecords} utilisateurs"
      responsiveLayout="scroll"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Nom Complet</th>
          <th>Email</th>
          <th>Téléphone</th>
          <th>Rôle</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-user>
        <tr>
          <td>
            <strong>{{ user.prenom }} {{ user.nom }}</strong>
          </td>
          <td>{{ user.email }}</td>
          <td>{{ user.telephone || 'N/A' }}</td>
          <td>
            <p-tag 
              [value]="getRoleDisplay(user.role)" 
              [severity]="getRoleSeverity(user.role)"
            ></p-tag>
          </td>
          <td>
            <p-tag 
              [value]="user.is_active ? 'Actif' : 'Inactif'" 
              [severity]="user.is_active ? 'success' : 'danger'"
            ></p-tag>
          </td>
          <td>
            <button 
              pButton 
              icon="pi pi-pencil" 
              class="p-button-text p-button-primary"
              (click)="editUtilisateur(user)"
              pTooltip="Modifier"
            ></button>
            <button 
              pButton 
              [icon]="user.is_active ? 'pi pi-times' : 'pi pi-check'" 
              class="p-button-text"
              [class.p-button-warning]="user.is_active"
              [class.p-button-success]="!user.is_active"
              (click)="toggleActive(user)"
              [pTooltip]="user.is_active ? 'Désactiver' : 'Activer'"
            ></button>
            <button 
              pButton 
              icon="pi pi-trash" 
              class="p-button-text p-button-danger"
              (click)="deleteUtilisateur(user)"
              pTooltip="Supprimer"
            ></button>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center">Aucun utilisateur trouvé</td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

<p-dialog 
  [(visible)]="displayDialog" 
  [header]="isEditing ? 'Modifier Utilisateur' : 'Nouvel Utilisateur'"
  [modal]="true" 
  [style]="{width: '50vw'}"
  (onHide)="onDialogHide()"
>
  <app-utilisateur-form 
    [utilisateur]="selectedUtilisateur"
    [isEditing]="isEditing"
    (formSubmitted)="displayDialog = false"
  ></app-utilisateur-form>
</p-dialog>

<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>