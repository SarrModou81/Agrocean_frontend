<!-- src/app/features/finances/factures-fournisseurs-list/factures-fournisseurs-list.component.html -->
<div class="factures-fournisseurs-container">
  <p-card>
    <div class="header-section">
      <h2>Factures Fournisseurs</h2>
    </div>

    <div class="filters-section">
      <div class="filter-group">
        <label>Statut</label>
        <p-dropdown 
          [(ngModel)]="selectedStatut"
          [options]="statuts"
          optionLabel="label"
          optionValue="value"
          placeholder="Tous les statuts"
          [showClear]="true"
        ></p-dropdown>
      </div>

      <div class="filter-actions">
        <button 
          pButton 
          icon="pi pi-search" 
          label="Filtrer"
          (click)="applyFilters()"
        ></button>
        <button 
          pButton 
          icon="pi pi-times" 
          label="Effacer"
          class="p-button-secondary"
          (click)="clearFilters()"
        ></button>
      </div>
    </div>

    <p-table 
      [value]="factures" 
      [loading]="loading"
      [paginator]="true"
      [rows]="pageSize"
      [totalRecords]="totalRecords"
      [lazy]="true"
      (onLazyLoad)="onPageChange($event)"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Affichage de {first} à {last} sur {totalRecords} factures"
      responsiveLayout="scroll"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Numéro</th>
          <th>Fournisseur</th>
          <th>Date Émission</th>
          <th>Date Échéance</th>
          <th>Montant Total</th>
          <th>Payé</th>
          <th>Restant</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-facture>
        <tr>
          <td><code>{{ facture.numero }}</code></td>
          <td><strong>{{ facture.fournisseur?.nom }}</strong></td>
          <td>{{ facture.date_emission | date:'dd/MM/yyyy' }}</td>
          <td>{{ facture.date_echeance | date:'dd/MM/yyyy' }}</td>
          <td>{{ formatCurrency(facture.montant_total) }}</td>
          <td>{{ formatCurrency(facture.montant_paye || 0) }}</td>
          <td class="text-danger"><strong>{{ formatCurrency(facture.montant_restant || facture.montant_total-facture.montant_paye) }}</strong></td>
          <td>
            <p-tag [value]="facture.statut" [severity]="getStatutSeverity(facture.statut)"></p-tag>
          </td>
          <td>
            <button 
              pButton 
              icon="pi pi-dollar" 
              class="p-button-text p-button-success"
              (click)="payerFacture(facture)"
              pTooltip="Payer"
              *ngIf="facture.statut !== 'Payée' && facture.statut !== 'Annulée'"
            ></button>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="9" class="text-center">Aucune facture fournisseur trouvée</td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

<!-- Dialog Paiement -->
<p-dialog 
  [(visible)]="displayPaiementDialog" 
  header="Payer Facture Fournisseur"
  [modal]="true" 
  [style]="{width: '500px'}"
  [draggable]="false"
  [resizable]="false"
>
  <app-paiement-form 
    [factureFournisseur]="selectedFacture"
    [typePaiement]="'fournisseur'"
    (formSubmitted)="onPaiementSubmitted()"
  ></app-paiement-form>
</p-dialog>

<p-toast></p-toast>